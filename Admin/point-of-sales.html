<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>POS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/pos.css">
    <link rel="stylesheet" href="../assets/css/sidebar.css">

    <!-- bootstrap icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet" />
</head>

<body>
    <div class="container-fluid mainContainer p-3">
        <div class="row">


            <!-- Offcanvas sidebar for small screens -->
            <div class="">
                <div class="row offcanvasContainer">

                    <div class="offcanvas offcanvas-start show" tabindex="-1" id="offcanvasSidebar"
                        aria-labelledby="offcanvasSidebarLabel" style="visibility: visible; background: white;">
                        <div class="offcanvas-header d-flex justify-content-between">
                            <div class="card rounded-5 mx-auto mb-2" style="align-self: center;">
                                <img src="../assets/img/round_logo.png" class="card-img-top" alt="logo" />
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"
                                style="align-self: flex-start;"></button>
                        </div>



                        <div class="offcanvas-body">
                            <div class="custom-sidebar rounded-5 p-4 bg-white border h-100">
                                <div class="sideBar pb-4">
                                    <p>MENU</p>
                                    <div class="nav-item d-flex justify-content-start align-items-center">
                                        <img src="../assets/img/dots.png" alt="Menu Icon" class="menu-icon ms-2" />
                                        <a class="nav-link active ms-2" href="home.html">Dashboard</a>
                                    </div>
                                    <div class="nav-item d-flex justify-content-start align-items-center">
                                        <img src="../assets/img/dots.png" alt="Menu Icon" class="menu-icon ms-2" />
                                        <a class="nav-link active ms-2" href="notification.html">Notification</a>
                                    </div>
                                    <div class="nav-item d-flex justify-content-start align-items-center">
                                        <img src="../assets/img/dots.png" alt="Menu Icon" class="menu-icon ms-2" />
                                        <a class="nav-link active ms-2" href="point-of-sales.html">POS</a>
                                    </div>
                                    <div class="nav-item d-flex justify-content-start align-items-center">
                                        <img src="../assets/img/dots.png" alt="Menu Icon" class="menu-icon ms-2" />
                                        <a class="nav-link active ms-2" href="notification.html">Order Management</a>
                                    </div>
                                    <div class="nav-item d-flex justify-content-start align-items-center">
                                        <img src="../assets/img/dots.png" alt="Menu Icon" class="menu-icon ms-2" />
                                        <a class="nav-link active ms-2" href="menu-management.html">Menu Management</a>
                                    </div>
                                    <div class="nav-item d-flex justify-content-start align-items-center">
                                        <img src="../assets/img/dots.png" alt="Menu Icon" class="menu-icon ms-2" />
                                        <a class="nav-link active ms-2" href="inventory-management.html">Inventory</a>
                                    </div>
                                </div>

                                <div class="sideBar pb-4">
                                    <p>FINANCIAL</p>
                                    <div class="nav-item d-flex justify-content-start align-items-center">
                                        <img src="../assets/img/dots.png" alt="Menu Icon" class="menu-icon ms-2" />
                                        <a class="nav-link active ms-2" href="sales-and-report.html">Sales and
                                            Report</a>
                                    </div>
                                </div>

                                <div class="sideBar pb-4 ">
                                    <p>TOOLS</p>
                                    <div class="nav-item d-flex justify-content-start align-items-center">
                                        <img src="../assets/img/dots.png" alt="Menu Icon" class="menu-icon ms-2" />
                                        <a class="nav-link active ms-2" href="#">Settings</a>
                                    </div>
                                    <div class="nav-item d-flex justify-content-start align-items-center">
                                        <img src="../assets/img/dots.png" alt="Menu Icon" class="menu-icon ms-2" />
                                        <a class="nav-link active ms-2" href="#">Logout</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main content column -->

            <div class="container-fluid">
                <div class="d-flex flex-column flex-lg-row pt-3">
                    <!-- POS content -->
                    <div class="flex-fill">
                        <div class="card p-3 topcontainer mb-3">
                            <div class="container-fluid">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div class="heading fw-bold" role="button" data-bs-toggle="offcanvas"
                                        data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar"
                                        style="cursor: pointer;">
                                        Point of Sale System
                                    </div>
                                    <button class="btn btn-light position-relative" data-bs-toggle="offcanvas"
                                        data-bs-target="#orderNotif" aria-controls="orderNotif">
                                        <i class="bi bi-bell-fill"></i>
                                        <span
                                            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                            3
                                            <span class="visually-hidden">unread messages</span>
                                        </span>
                                    </button>
                                </div>
                                <div class="subtitle pb-3">Payment Management</div>
                                <div class="subheading"><span style="font-weight: bold;">Menu</span> Category</div>
                                <div class="category-scroll d-flex gap-3 overflow-auto pb-2" id="categories">
                                    <!-- Categories -->
                                </div>
                            </div>
                        </div>

                        <div class="card overflow-auto p-3 maincontainer">
                            <div class="subheading">
                                <span style="font-weight: bold;">Menu</span> Items
                            </div>
                            <div class="row g-3 row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-6"
                                id="maincontainer">
                                <!-- Menu items -->
                            </div>
                        </div>
                    </div>

                    <!-- Receipt -->
                    <div class="flex-lg-shrink-0 ms-0 ms-lg-3 mt-3 mt-lg-0" style="min-width: 300px;">
                        <div class="card p-3 overflow-auto" style="height: 100%;">
                            <div class="category-title"><span style="font-weight: bold;">Menu</span> Receipt</div>
                            <div class="container-fluid">
                                <div class="line-divider"></div>
                            </div>
                            <div id="receipt"><!-- receipt items --></div>
                            <div class="container-fluid">
                                <div class="line-divider" style="height: 1px;"></div>
                                <div class="mt-4 d-flex flex-row justify-content-between">
                                    <div><b>TOTAL</b></div>
                                    <div><b id="totalValue">0</b></div>
                                </div>
                                <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-4">
                                    <button class="btn btn-success w-100 w-md-auto" onclick="openPopup()">Order
                                        Now</button>
                                    <button class="btn btn-danger w-100 w-md-auto">Cancel Order</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- notif part -->
            <div class="offcanvas offcanvas-end " tabindex="-1" id="orderNotif" aria-labelledby="orderNotifLabel"
                style="width: 500px;">
                <div class="offcanvas-header">
                    <h5 class="subheading fw-bold" id="orderNotifLabel">Order Notification</h5>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
                </div>
                <div class="offcanvas-body">
                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-outline-dark btn-sm lead rounded-4 fw-bold p-2">All Orders</button>
                        <button class="btn btn-outline-dark btn-sm lead rounded-4 fw-bold">Preparing</button>
                        <button class="btn btn-outline-dark btn-sm lead rounded-4 fw-bold">Ready</button>
                        <button class="btn btn-outline-dark btn-sm lead rounded-4 fw-bold">Completed</button>
                    </div>

                    <div class="card mb-3 p-3 rounded-5" style="border-color: var(--text-color-dark);">
                        <div class="fw-bold fs-5">Name</div>
                        <div class="fs-6">1x Amerikano <br> ₱140</div>
                        <div class="d-flex justify-content-end gap-2 mt-3">
                            <button class="btn btn-dark btn-sm px-3 py-2 rounded-4">Accept</button>
                            <button class="btn btn-outline-dark btn-sm px-3 py-2 rounded-4">Decline</button>
                        </div>
                    </div>

                    <div class="card mb-3 p-3 rounded-5" style="border-color: var(--text-color-dark);">
                        <div class="fw-bold fs-5">Name</div>
                        <div class="fs-6">1x Amerikano <br> ₱140</div>
                        <div class="d-flex justify-content-end gap-2 mt-3">
                            <button class="btn btn-dark btn-sm px-3 py-2 rounded-4">Accept</button>
                            <button class="btn btn-outline-dark btn-sm px-3 py-2 rounded-4">Decline</button>
                        </div>
                    </div>

                    <div class="card mb-3 p-3 rounded-5" style="border-color: var(--text-color-dark);">
                        <div class="fw-bold fs-5">Name</div>
                        <div class="fs-6">1x Amerikano <br> ₱140</div>
                        <div class="d-flex justify-content-end gap-2 mt-3">
                            <button class="btn btn-dark btn-sm px-3 py-2 rounded-4">Accept</button>
                            <button class="btn btn-outline-dark btn-sm px-3 py-2 rounded-4">Decline</button>
                        </div>
                    </div>


                </div>
            </div>


            <!-- Order Confirmation Modal -->
            <div id="modal-placeholder"></div>




            <script>
                fetch('products.json')
                    .then(response => response.json())
                    .then(data => {
                        products = data;
                        loadCategories();
                    });


                var total = 0;

                function loadCategories() {
                    var categoriesContainer = document.getElementById("categories");
                    products.forEach((product, index) => {
                        categoriesContainer.innerHTML += `
            <div onclick="selectCategory(this, '` + index + `')" 
                 class="category-pill text-center">
                ` + product.category + `
            </div>`;
                    });
                }

                function selectCategory(element, index) {
                    // Remove active class from all category pills
                    document.querySelectorAll('.category-pill').forEach(pill => {
                        pill.classList.remove('active');
                    });

                    // Add active to the clicked one
                    element.classList.add('active');

                    // Load products
                    loadProducts(index);
                }

                function loadProducts(categoryIndex) {
                    var maincontainer = document.getElementById("maincontainer");
                    maincontainer.innerHTML = "";

                    if (categoryIndex == 0 || categoryIndex == 1) {
                        products[categoryIndex].contents.forEach(content => {
                            content.sizes.forEach(size => {
                                maincontainer.innerHTML += `
    <div class="col">
        <div onclick="addToReceipt('` + size.price + `','` + content.code + size.code + `','` + content.name + `')" 
             class="menu-item border p-3 rounded shadow-sm text-center width-auto card-hover" 
             style="cursor: pointer;">
            <img src="../assets/img/` + content.img + `" alt="` + content.name + `" class="img-fluid mb-2" style="max-height: 150px;">
            <div class="lead menu-name fw-bold">` + content.name + ' ' + size.code + `</div>
            <div class="d-flex justify-content-center align-items-center gap-2 my-2">
                <span class="lead fw-bold menu-price">₱` + size.price + `</span>
                <span class="lead menu-size">` + size.code + `</span>
            </div>
        </div>
    </div>`;

                            });
                        });
                    } else {
                        products[categoryIndex].contents.forEach(content => {
                            maincontainer.innerHTML += `
    <div class="col">
        <div onclick="addToReceipt('` + content.price + `','` + content.code + `','` + content.name + `')" 
             class="menu-item border p-3 rounded shadow-sm text-center width-auto card-hover" 
             style="cursor: pointer;">
            <img src="../assets/img/` + content.img + `" alt="` + content.name + `" class="img-fluid mb-2" style="max-height: 150px;">
            <div class="lead menu-name fw-bold">` + content.name + `</div>
            <div class="d-flex justify-content-center align-items-center gap-2 my-2">
                <span class="lead fw-bold menu-price">₱` + content.price + `</span>
            </div>
        </div>
    </div>`;


                        });
                    }
                }

                function addToReceipt(price, code, name) {
                    var receiptContainer = document.getElementById("receipt");
                    total = parseFloat(total) + parseFloat(price);

                    var totalValueElement = document.getElementById("totalValue");
                    totalValueElement.innerHTML = total;

                    receiptContainer.innerHTML += `
        <div class="d-flex flex-row justify-content-between align-items-center mb-1">
            <div class="flex-grow-1">
                <small><span style="font-weight: bold;">` + name + ` | </span>` + code + `</small>
            </div>
            <div>
                <small>₱ ` + price + `</small>
            </div>
        </div>`;

         let orderData = []; // To store all confirmed orders

    function openPopup() {
        const receiptItems = document.querySelectorAll('#receipt .receipt-item');
        const summaryList = document.getElementById('orderSummaryList');
        summaryList.innerHTML = '';

        const currentOrder = [];

        receiptItems.forEach(item => {
            const name = item.querySelector('.item-name')?.textContent || '';
            const qty = item.querySelector('.item-qty')?.textContent || '';
            const price = item.querySelector('.item-price')?.textContent || '';

            if (name && qty) {
                summaryList.innerHTML += `<li>${qty}x ${name}</li>`;
                currentOrder.push({ name, quantity: qty, price });
            }
        });

        // Store in modal's data attribute
        document.getElementById('confirmModal').dataset.currentOrder = JSON.stringify(currentOrder);

        // Show the modal
        const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
        modal.show();
    }

    // Confirm button event
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelector('.confirm-order-btn').addEventListener('click', () => {
            const modalEl = document.getElementById('confirmModal');
            const confirmedOrder = JSON.parse(modalEl.dataset.currentOrder || '[]');
            orderData.push(confirmedOrder); // Save to array

            // Add to notification area
            const notifContainer = document.querySelector('#orderNotif .offcanvas-body');
            const notifHTML = `
                <div class="card mb-3 p-3 rounded-5" style="border-color: var(--text-color-dark);">
                    <div class="fw-bold fs-5">Customer</div>
                    <div class="fs-6">
                        ${confirmedOrder.map(item => `${item.quantity}x ${item.name}`).join('<br>')}
                    </div>
                    <div class="d-flex justify-content-end gap-2 mt-3">
                        <button class="btn btn-dark btn-sm px-3 py-2 rounded-4">Accept</button>
                        <button class="btn btn-outline-dark btn-sm px-3 py-2 rounded-4">Decline</button>
                    </div>
                </div>`;
            notifContainer.insertAdjacentHTML('beforeend', notifHTML);

            // Clear receipt and total
            document.getElementById('receipt').innerHTML = '';
            document.getElementById('totalValue').textContent = '0';

            // Close modal
            bootstrap.Modal.getInstance(modalEl).hide();
        });
    });








                    document.addEventListener("DOMContentLoaded", function () {
                        const offcanvasElement = document.getElementById("offcanvasSidebar");
                        const bsOffcanvas = bootstrap.Offcanvas.getOrCreateInstance(offcanvasElement);

                        // Open offcanvas by default on small screens
                        if (window.innerWidth < 768) {
                            bsOffcanvas.show();
                        }
                    });

                    fetch("../modal/pos-modal.html")
                        .then(res => res.text())
                        .then(data => {
                            document.getElementById("modal-placeholder").innerHTML = data;
                            document.querySelector('.addbtn').addEventListener('click', function (e) {
                                e.preventDefault();
                                confirmOrder();
                            });
                        });


                }

                function openPopup() {
                    const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
                    modal.show();
                }

                function confirmOrder() {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
                    modal.hide();

                    const toastElement = document.getElementById('orderToast');
                    const toast = new bootstrap.Toast(toastElement);
                    toast.show();
                }



                loadCategories();




            </script>


            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
                crossorigin="anonymous"></script>





            <!-- Add this script at the bottom to initialize Bootstrap offcanvas -->
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const offcanvasElement = document.getElementById("offcanvasSidebar");
                    const bsOffcanvas = bootstrap.Offcanvas.getOrCreateInstance(offcanvasElement);

                    // Open offcanvas by default on small screens
                    if (window.innerWidth < 768) {
                        bsOffcanvas.show();
                    }
                });
            </script>
            <script src=" https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
                crossorigin="anonymous">
                </script>
</body>

</html>