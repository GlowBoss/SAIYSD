<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Coffee</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/coffee.css">
    <link rel="icon" href="../assets/img/round_logo.png" type="image/png">
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-custom fixed-top py-2" style="background-color: white;">
        <div class="container-fluid p-0">
            <!-- Left: Logo -->
            <a class="navbar-brand fw-bold" href="#">
                <img src="assets/img/saisydLogo.png" alt="SAISYD Logo" style="height: 50px;">
            </a>

            <!-- Right: Toggle + Icon (for small screens) -->
            <div class="d-flex align-items-center">
                <!-- Icon visible only on small screens -->
                <a href="cart.html" class="d-block d-lg-none ">
                    <img src="https://cdn-icons-png.flaticon.com/512/4903/4903482.png" class="icon-bag" />
                </a>

                <!-- Toggle button -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#saisydNavbar"
                    aria-controls="saisydNavbar" aria-expanded="false" aria-label="Toggle navigation"
                    style="background: none; border: none; box-shadow: none; padding: 0;">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>

            <!-- Center: Nav links | Right: Icon + Button for large screens -->
            <div class="collapse navbar-collapse" id="saisydNavbar">
                <!-- Centered Nav Links -->
                <ul class="navbar-nav mx-auto mb-2 mb-lg-0 d-flex align-items-lg-center gap-lg-4">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="menu.html">Coffee</a></li>
                    <li class="nav-item"><a class="nav-link" href="index.html#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="index.html#location">Location</a></li>

                </ul>

                <!-- Only the icon will hide on small screens -->
                <div class="d-flex align-items-center mt-lg-0">
                    <!-- Large screen icon only -->
                    <a href="cart.html" class="d-none d-lg-block">
                        <img src="https://cdn-icons-png.flaticon.com/512/4903/4903482.png" class="icon-bag" />
                    </a>

                    <!-- Contact Us should always be visible -->
                    <button class="contact-btn ms-0 ms-lg-2">Contact Us</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- main container -->
    <div class="container-fluid mt-5 d-none d-md-block">

        <!-- coffee-banner -->
        <div class="coffee-banner">
            <div class="d-flex flex-column justify-content-center align-items-start text-start text-md-start mt-sm-5"
                style="height: 100vh;">
                <div class="coffee-banner-title title mb-3">Daily Delights</div>
                <div class="coffee-banner-desc lead">
                    Our meals and drinks are freshly prepared every day. We use quality ingredients to bring out
                    the best flavors. Enjoy a delicious treat that brightens your everyday moments.
                </div>
            </div>
        </div>
    </div>

    <!-- Categories + Sort Section -->
    <div class="container-fluid px-sm-2 px-md-4 px-lg-5 mt-5 mt-lg-4">
        <!-- Top Row: Categories Label + Sort -->
        <div
            class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2 mb-2">

            <!-- Categories Label -->
            <div class="title-category heading">Categories</div>

            <!-- Sort Dropdown -->
            <div class="d-flex align-items-center gap-2 px-3 py-2 border rounded-pill shadow-sm mx-auto mx-md-0"
                style="background-color: var(--card-bg-color); font-family: var(--primaryFont); font-size: var(--lead); font-weight: 500; color: var(--text-color-dark); border-color: var(--primary-color);">
                <i class="bi bi-funnel-fill" style="color: var(--text-color-dark); font-size: 1rem;"></i>
                <label for="sortSelect" class="mb-0 fw-semibold">Sort by:</label>
                <select id="sortSelect" class="form-select form-select-sm border-0 bg-transparent shadow-none"
                    style="width: 160px; font-weight: 600; font-size: var(--lead); font-family: var(--primaryFont); color: var(--text-color-dark);">
                    <option value="popularity">Popularity</option>
                    <option value="price-low-high">Price: Low to High</option>
                    <option value="price-high-low">Price: High to Low</option>
                    <option value="newest">Newest</option>
                </select>
            </div>
        </div>

        <!-- Category Pills Row -->
        <div class="category-scroll d-flex gap-3 overflow-auto py-3">
            <div class="category-pill text-center active" data-category="All">All</div>
            <div class="category-pill text-center" data-category="Coffee">Coffee</div>
            <div class="category-pill text-center" data-category="Tea">Tea</div>
            <div class="category-pill text-center" data-category="Food">Food</div>
        </div>
    </div>

    <div class="products-section border p-3 p-lg-5">
        <div class="row g-3 row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-6" id="productGrid">
            <!-- PRODUCTS -->
        </div>
    </div>

    <!-- Confirm Item Customization Modal -->
    <div id="modal-placeholder"></div>

    <!-- Footer -->
    <footer class="bg-footer text-dark pt-5 pb-3">
        <div class="container">
            <div class="d-lg-none accordion" id="footerAccordion">
                <!-- SAISYD -->
                <div class="accordion-item border-0">
                    <h2 class="accordion-header">
                        <button class="accordion-button bg-footer text-dark fw-bold" type="button"
                            data-bs-toggle="collapse" data-bs-target="#collapseSaisyd">
                            SAISYD
                        </button>
                    </h2>
                    <div id="collapseSaisyd" class="accordion-collapse collapse show">
                        <div class="accordion-body small">
                            Donec imperdiet sit amet sem consectetur tincidunt. In pulvinar ex ut tempus tincidunt.
                            Cras vitae orci risus. Fusce eget dictum ex, a vulputate mi. Aliquam in mattis quam,
                            vel laoreet elit. Pellentesque nulla leo, tristique at ex eget, efficitur bibendum tortor.
                        </div>
                    </div>
                </div>

                <!-- MarketPlace -->
                <div class="accordion-item border-0">
                    <h2 class="accordion-header">
                        <button class="accordion-button bg-footer text-dark fw-bold collapsed" type="button"
                            data-bs-toggle="collapse" data-bs-target="#collapseMarket">
                            MarketPlace
                        </button>
                    </h2>
                    <div id="collapseMarket" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <ul class="list-unstyled mb-0">
                                <li><a href="#" class="text-dark text-decoration-none footer-link">Services</a></li>
                                <li><a href="#" class="text-dark text-decoration-none footer-link">Products</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Company -->
                <div class="accordion-item border-0">
                    <h2 class="accordion-header">
                        <button class="accordion-button bg-footer text-dark fw-bold collapsed" type="button"
                            data-bs-toggle="collapse" data-bs-target="#collapseCompany">
                            Company
                        </button>
                    </h2>
                    <div id="collapseCompany" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <ul class="list-unstyled mb-0">
                                <li><a href="#" class="text-dark text-decoration-none footer-link">About Servelt</a>
                                </li>
                                <li><a href="#" class="text-dark text-decoration-none footer-link">Help Center</a></li>
                                <li><a href="#" class="text-dark text-decoration-none footer-link">Contact Us</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Follow Us -->
                <div class="accordion-item border-0">
                    <h2 class="accordion-header">
                        <button class="accordion-button bg-footer text-dark fw-bold collapsed" type="button"
                            data-bs-toggle="collapse" data-bs-target="#collapseFollow">
                            Follow Us
                        </button>
                    </h2>
                    <div id="collapseFollow" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <p class="mb-1">
                                <a href="https://www.tiktok.com/@saisyd" target="_blank"
                                    class="text-dark text-decoration-none footer-link">
                                    <i class="fab fa-tiktok me-2"></i>SAISYD
                                </a>
                            </p>

                        </div>
                    </div>
                </div>
            </div>

            <!-- Desktop View (visible on large screens and up) -->
            <div class="row gy-4 d-none d-lg-flex">
                <div class="col-lg-4">
                    <h5 class="fw-bold">SAISYD</h5>
                    <p class="small">
                        Donec imperdiet sit amet sem consectetur tincidunt. In pulvinar ex ut tempus tincidunt.
                        Cras vitae orci risus. Fusce eget dictum ex, a vulputate mi. Aliquam in mattis quam,
                        vel laoreet elit. Pellentesque nulla leo, tristique at ex eget, efficitur bibendum tortor.
                    </p>
                </div>
                <div class="col-lg-2">
                    <h6 class="fw-bold">MarketPlace</h6>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-dark text-decoration-none footer-link">Services</a></li>
                        <li><a href="#" class="text-dark text-decoration-none footer-link">Products</a></li>
                    </ul>
                </div>
                <div class="col-lg-2">
                    <h6 class="fw-bold">Company</h6>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-dark text-decoration-none footer-link">About Servelt</a></li>
                        <li><a href="#" class="text-dark text-decoration-none footer-link">Help Center</a></li>
                        <li><a href="#" class="text-dark text-decoration-none footer-link">Contact Us</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 offset-lg-1">
                    <h6 class="fw-bold">FOLLOW US</h6>
                    <p class="mb-1">
                        <a href="https://www.tiktok.com/@saisyd" target="_blank"
                            class="text-dark text-decoration-none footer-link">
                            <i class="fab fa-tiktok me-2"></i>SAISYD
                        </a>
                    </p>

                </div>
            </div>

            <!-- Footer Bottom -->
            <div class="border-top mt-4 pt-3 d-flex justify-content-between align-items-center flex-wrap">
                <p class="lead mb-0 small">© 2024 Copyright:
                    <span class="fw-bold">SAISYD CAFE</span>
                </p>
                <div class="d-flex gap-3 fs-5">
                    <a href="#" class="text-dark"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-dark"><i class="fab fa-google"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>

    <script>
        // Load item customization modal
        fetch("modal/item-customization.html")
            .then(res => res.text())
            .then(data => {
                document.getElementById("modal-placeholder").innerHTML = data;

                // Add button listener
                const addBtn = document.querySelector('.addbtn');
                if (addBtn) {
                    addBtn.addEventListener('click', function (e) {
                        e.preventDefault();
                        confirmOrder();
                    });
                }

                const modalEl = document.getElementById('item-customization');
                if (modalEl) {
                    modalEl.addEventListener('hidden.bs.modal', () => {
                        document.body.style.overflow = '';
                        document.body.classList.remove('modal-open');
                        document.querySelector('.modal-backdrop')?.remove();
                    });
                }
            })
            .catch(error => {
                console.error('Error loading item customization modal:', error);
            });

        function openPopup(button) {
            const modal = new bootstrap.Modal(document.getElementById('item-customization'));
            modal.show();

            const name = button.getAttribute('data-name');
            const sizes = JSON.parse(button.getAttribute('data-sizes'));
            const sugars = JSON.parse(button.getAttribute('data-sugar'));
            const type = button.getAttribute('data-type');
            const iceSection = document.getElementById('ice-section');

            if (type === 'beverage') {
                iceSection.style.display = 'block';
            } else {
                iceSection.style.display = 'none';
            }

            // Set name and clear base price
            document.querySelector('.itemName').textContent = name;
            document.querySelector('.itemPrice').textContent = '';

            // === SIZE OPTIONS ===
            const sizeSection = document.getElementById('size-section');
            const sizeContainer = document.getElementById('size-options');
            if (type === 'beverage') {
                sizeSection.style.display = 'block';
                sizeContainer.innerHTML = '';

                sizes.forEach((sz, i) => {
                    const id = `size${sz.name.replace(/\s/g, '')}`;
                    const html = `
            <div class="col">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="priceOptions" id="${id}" value="${sz.name}" ${i === 1 ? 'checked' : ''}>
                    <label class="form-check-label h6" for="${id}">${sz.name}</label>
                </div>
            </div>`;
                    sizeContainer.insertAdjacentHTML('beforeend', html);
                });

                // Update price when size changes
                document.querySelectorAll('input[name="priceOptions"]').forEach(radio => {
                    radio.addEventListener('change', () => updateModalPrice(sizes));
                });

                // Set initial price
                updateModalPrice(sizes);

            } else {
                sizeSection.style.display = 'none';
                // Set price for food immediately
                const product = allProducts.find(p => p.name === name);
                if (product) {
                    document.querySelector('.itemPrice').textContent = `₱${product.price}`;
                }
            }

            // === SUGAR OPTIONS ===
            const sugarSection = document.getElementById('sugar-section');
            const sugarContainer = document.getElementById('sugar-options');
            if (type === 'beverage') {
                sugarSection.style.display = 'block';
                sugarContainer.innerHTML = '';
                sugars.forEach((sugar, i) => {
                    const id = `sugar${sugar}`;
                    const html = `
            <div class="col">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="sugarOption" id="${id}" value="${sugar}" ${i === 0 ? 'checked' : ''}>
                    <label class="form-check-label h6" for="${id}">${sugar}%</label>
                </div>
            </div>`;
                    sugarContainer.insertAdjacentHTML('beforeend', html);
                });
            } else {
                sugarSection.style.display = 'none';
            }
        }

        function updateModalPrice(sizes) {
            const selectedSize = document.querySelector('input[name="priceOptions"]:checked')?.value;
            const match = sizes.find(sz => sz.name === selectedSize);
            if (match) {
                document.querySelector('.itemPrice').textContent = `₱${match.price}`;
            }
        }

        function confirmOrder() {
            const name = document.querySelector('.itemName').textContent;
            const size = document.querySelector('input[name="priceOptions"]:checked')?.value || '';
            const sugar = document.querySelector('input[name="sugarOption"]:checked')?.value || '';
            const ice = document.querySelector('input[name="iceOptions"]:checked')?.id || '';
            const note = document.getElementById('customer_notes')?.value || '';

            const type = document.getElementById('size-section').style.display === 'none' ? 'food' : 'beverage';

            // ✅ FIXED: Create better display name
            let displayName = name;
            let finalName = name;
            if (type === 'beverage') {
                finalName = `${name}_${size}_${sugar}s_${ice}`;
                // Keep display name clean for cart
                displayName = name;
            }

            // Get price
            let price = 0;
            if (type === 'beverage') {
                const selectedSize = document.querySelector('input[name="priceOptions"]:checked')?.value;
                const buyBtn = document.querySelector(`.buy-btn[data-name="${name}"]`);
                if (buyBtn) {
                    const allSizes = JSON.parse(buyBtn.getAttribute('data-sizes'));
                    const match = allSizes.find(sz => sz.name === selectedSize);
                    if (match) price = match.price;
                }
            } else {
                const product = allProducts.find(p => p.name === name);
                if (product) price = product.price;
            }

            // Get category
            const product = allProducts.find(p => p.name === name);
            const validCategories = ['Coffee', 'Tea', 'Food'];
            let category = product?.category || 'Unknown';
            if (!validCategories.includes(category)) {
                category = 'Unknown';
            }

            // ✅ FIXED: Create consistent order object structure
            const order = {
                name: finalName,        // Full name with customizations for uniqueness
                displayName: displayName, // Clean name for display
                quantity: 1,
                dataCategory: category,
                price: price,           // Store as number for calculations
                notes: note,
                size: size,
                sugar: sugar,
                ice: ice.replace('ice', ''), // Clean ice option
                type: type,
                addedAt: new Date().toISOString()
            };

            // ✅ FIXED: Add to existing cart items or create new
            let currentOrders = [];
            try {
                const existingData = localStorage.getItem("orders");
                currentOrders = existingData ? JSON.parse(existingData) : [];
            } catch (error) {
                console.error('Error parsing existing orders:', error);
                currentOrders = [];
            }

            // Check if same item already exists in cart
            const existingIndex = currentOrders.findIndex(item =>
                item.name === order.name &&
                item.size === order.size &&
                item.sugar === order.sugar &&
                item.ice === order.ice
            );

            if (existingIndex > -1) {
                // Increase quantity of existing item
                currentOrders[existingIndex].quantity++;
            } else {
                // Add new item
                currentOrders.push(order);
            }

            // ✅ FIXED: Save to consistent localStorage key
            localStorage.setItem("orders", JSON.stringify(currentOrders));

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('item-customization'));
            if (modal) modal.hide();

            // Fix scroll and backdrop
            document.body.style.overflow = '';
            document.body.classList.remove('modal-open');
            document.querySelector('.modal-backdrop')?.remove();

            // Show toast
            const toast = new bootstrap.Toast(document.getElementById('orderToast'));
            if (toast) toast.show();

            // ✅ NEW: Update cart badge if function exists
            if (typeof updateCartBadge === 'function') {
                updateCartBadge();
            }

            console.log("Item added to cart:", order);
            console.log("Current cart:", currentOrders);
        }

        let allProducts = [];

        async function fetchProducts() {
            try {
                const res = await fetch('Admin/products.json');
                const data = await res.json();

                // Flatten contents
                allProducts = [];
                data.forEach(category => {
                    category.contents.forEach(product => {
                        const base = {
                            ...product,
                            category: category.category
                        };
                        allProducts.push(base);
                    });
                });
                displayProducts();
            } catch (error) {
                console.error('Error fetching products:', error);
            }
        }

        function displayProducts(filterCategory = 'All', sortOption = 'popularity') {
            let filtered = [...allProducts];

            // Filter
            if (filterCategory !== 'All') {
                filtered = filtered.filter(p => p.category === filterCategory);
            }

            // Sort
            switch (sortOption) {
                case 'price-low-high':
                    filtered.sort((a, b) => getPrice(a) - getPrice(b));
                    break;
                case 'price-high-low':
                    filtered.sort((a, b) => getPrice(b) - getPrice(a));
                    break;
                case 'newest':
                    filtered.sort(() => Math.random() - 0.5);
                    break;
                case 'popularity':
                default:
                    filtered.sort(() => Math.random() - 0.5);
            }

            const grid = document.getElementById('productGrid');
            if (!grid) return;

            grid.innerHTML = '';
            filtered.forEach(prod => {
                // Construct size+price string for display
                let sizePriceDisplay = '';
                if (prod.sizes && prod.sizes.length > 0) {
                    sizePriceDisplay = prod.sizes
                        .map(sz => `${sz.name} – ₱${sz.price}`)
                        .join(' | ');
                } else {
                    sizePriceDisplay = `₱${prod.price}`;
                }

                const html = `
            <div class="col">
                <div class="menu-item text-center shadow-sm" style="
                    height: 320px; 
                    background-color: #fff9f2; 
                    border-radius: 20px; 
                    border: 1px solid #e0c9a6;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); 
                    display: flex; 
                    flex-direction: column; 
                    justify-content: space-between; 
                    padding: 15px;
                    transition: transform 0.2s ease;
                ">
                    <div style="height: 150px; display: flex; align-items: center; justify-content: center;">
                        <img src="assets/img/${prod.img}" alt="${prod.name}" class="img-fluid" 
                            style="max-height: 100%; max-width: 100%; object-fit: contain;">    
                    </div>
                    <div class="subheading menu-name" style="
                        font-size: 1.2rem; 
                        font-weight: 500; 
                        color: #4b2e2e;
                        margin-top: 10px;
                    ">
                        ${prod.name}
                    </div>  
                    <div class="d-flex justify-content-center align-items-center text-center px-2" style="color: #6e4f3a; font-size: 0.85rem;">
                        ${sizePriceDisplay}
                    </div>
                    <button class="lead buy-btn mt-auto" 
                        data-bs-toggle="modal" 
                        data-bs-target="#item-customization"
                        data-name="${prod.name}"
                        data-price="${getPrice(prod)}"
                        data-sizes='${JSON.stringify(prod.sizes || [])}'
                        data-sugar='${JSON.stringify(prod.sugarLevels || [])}'
                        data-type="${prod.sizes ? 'beverage' : 'food'}" 
                        onclick="openPopup(this)">Buy</button>
                </div>
            </div>`;
                grid.innerHTML += html;
            });
        }

        function getPrice(prod) {
            if (prod.sizes && prod.sizes.length) return prod.sizes[0].price;
            return prod.price || 0;
        }

        // Category click
        document.querySelectorAll('.category-pill').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.category-pill').forEach(el => el.classList.remove('active'));
                item.classList.add('active');
                const category = item.dataset.category;
                const sort = document.getElementById('sortSelect')?.value || 'popularity';
                displayProducts(category, sort);
            });
        });

        // Sort change
        const sortSelect = document.getElementById('sortSelect');
        if (sortSelect) {
            sortSelect.addEventListener('change', e => {
                const selectedSort = e.target.value;
                const activeCat = document.querySelector('.category-pill.active')?.dataset.category || 'All';
                displayProducts(activeCat, selectedSort);
            });
        }

        // ✅ NEW: Cart badge update function
        function updateCartBadge() {
            try {
                const rawData = localStorage.getItem("orders");
                const orderData = rawData ? JSON.parse(rawData) : [];
                const totalItems = orderData.reduce((sum, item) => sum + item.quantity, 0);

                const badge = document.querySelector('.cart-badge');
                if (badge) {
                    badge.textContent = totalItems;
                    badge.style.display = totalItems > 0 ? 'inline' : 'none';
                }
            } catch (error) {
                console.error('Error updating cart badge:', error);
            }
        }

        // Initialize
        fetchProducts();

        // Update cart badge on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateCartBadge();
        });
    </script>


    <script src="assets/js/swiper-bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
</body>

</html>